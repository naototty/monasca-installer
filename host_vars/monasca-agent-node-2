---
# Copyright 2016 FUJITSU LIMITED
# file: host_vars/monasca-agent-node-2

# Monasca Agent user credentials
monasca_agent_user: cmm-agent
monasca_agent_password: "{{ cmm_monasca_agent_keystone_password }}"
monasca_agent_project: cmm

# Monasca Agent Configuration
monasca_agent_service: monitoring

# kafka_check_settings, they are correlated in the monasca-agent check
# see https://github.com/openstack/monasca-agent/blob/master/monasca_agent/collector/checks_d/kafka_consumer.py#L123
kafka_consumer_per_partition: False
kafka_consumer_full_output: "{{ kafka_consumer_per_partition|bool }}"

# Additionally you can specify any number of name:value pairs in 'init_config'
# which will be available on every run in 'self.init_config'
monasca_checks:
  kafka_consumer:
    init_config:
    instances:
    - built_by: Kafka
      name: "{{ ansible_fqdn }}"
      kafka_connect_str: "{{ ansible_ssh_host }}:{{ kafka_port|int }}"
      per_partition: "{{ kafka_consumer_per_partition|bool }}"
      full_output: "{{ kafka_consumer_full_output|bool }}"
      consumer_groups:
        thresh-event:
          - events
        log-metric:
          - transformed-log
        logstash-persister:
          - transformed-log
        1_metrics:
          - metrics
        transformer-logstash-consumer:
          - log
        1_alarm-state-transitions:
          - alarm-state-transitions
        thresh-metric:
          - metrics
  host_alive:
    init_config:
      ssh_port: 22
      ssh_timeout: 0.5
      ping_timeout: 1
    instances:
      - name: openstack
        host_name: "{{ keystone_host }}"
        alive_test: ssh
  elastic:
    init_config:
    instances:
      - url: "{{ elasticsearch_url }}"
        dimensions:
          component: elasticsearch
          service: monitoring
  http_check:
    init_config:
    instances:
      - name: Kibana
        url: "{{ kibana_url }}"
        timeout: 1
        dimensions:
          component: kibana
          service: monitoring
      - name: Monasca Log Api
        url: "http://{{ ansible_ssh_host }}:{{ monasca_log_api_port|int }}/healthcheck"
        timeout: 1
        dimensions:
          component: monasca-log-api
          service: monitoring
  # this one's different because concatenated with default file
  process:
    init_config:
    instances:
      - built_by: MonLogMetrics
        detailed: true
        name: monasca.log.metrics
        search_string: ['monasca-log-metrics']
        exact_match: False
        dimensions:
          component: monasca-log-metrics
          service: monitoring
      - built_by: MonLogAgent
        detailed: true
        name: monasca.log.agent
        search_string: ['monasca-log-agent']
        exact_match: False
        dimensions:
          component: monasca-log-agent
          service: monitoring
      - built_by: MonLogTransformer
        detailed: true
        name: monasca.log.transformer
        search_string: ['transformer.conf']
        exact_match: False
        dimensions:
          component: monasca-log-transformer
          service: monitoring
      - built_by: MonLogPersister
        detailed: true
        name: monasca.log.persister
        search_string: ['persister.conf']
        exact_match: False
        dimensions:
          component: monasca-log-persister
          service: monitoring
      - built_by: MonLogApi
        detailed: true
        name: monasca.log.api
        search_string: ['monasca-log-api']
        exact_match: False
        dimensions:
          component: monasca-log-api
          service: monitoring

pip_extra_depedencies:
- { name: psutil, version: 2.2.1 }
- { name: pymysql, version: 0.7.2 }
- { name: kafka-python, version: 0.9.5 }
