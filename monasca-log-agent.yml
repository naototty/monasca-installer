---
- name: Prepare/Configure host
  hosts: monasca_log_agent_group
  sudo: yes
  vars_files:
    - credentials.yml
  pre_tasks:
    - include: tasks/set_up.yml tags=pre_tasks
    - include: tasks/verify_credentials.yml tags=agents,log-agent
  roles:
    - {role: pip, tags: [pip, resources]}

- name: Install Monasca-Log-Agent
  hosts: monasca_log_agent_group
  sudo: yes
  vars_files:
    - credentials.yml
  roles:
    - {role: logrotate, tags: [logrotate]}
    - {role: monasca-log-agent, tags: [log-agent, agents]}

- name: Clean-Up host
  hosts: monasca_log_agent_group
  sudo: yes
  post_tasks:
    - include: tasks/clean_up.yml tags=post_tasks
